import { Head, Image, Appear } from 'mdx-deck'
import { Split, FullScreenCode } from 'mdx-deck/layouts'
import { CodeSurfer } from "mdx-deck-code-surfer";

import { Cover } from './Cover';
import { Intro } from './Intro';
import { Img } from './Img';
import { InlineImg } from './InlineImg';
import { Thanks } from './Thanks';
import { Feedback } from './Feedback';

export { default as theme } from './theme'

<Head>
  <title>Practical Hooks, Redux Hooks and Fast Refresh</title>
</Head>

<Cover />

---

<Intro />

---

## Overview

<ul>
    <Appear>
        <li>
            React Components
        </li>
        <li>
          Primitive Hooks
        </li>
        <li>
          Redux Hooks
        </li>
        <li>
          Fast Refresh
        </li>
    </Appear>
</ul>

---

### React Components

<Img src='./img/components.jpeg' width={700} />

---

### React Components

- Declarative
- Encapsulated state
- Composable

---

### Declarative

- Declare how your view will look like
- React will update DOM or another host tree

---

### Encapsulated State

- Each component manage its own state

---

### Composable

- You can compose components to create complex UIs

---

## React Components

<Img src='./img/function.png' width={1000} />

---

### Props

- Properties to modify a component
- Read only, can't be modified

---

### State

- Something that will change in the scope of the component

---

## React Components

<Img src='./img/functionEffects.png' width={1000} />

---

### Effects

- Side effect created by a component

---

### Component Dichotomy

- It acts as a pure function in some cases
- It acts as a stateful logics in some cases
- It can cause side effects in some cases

---

### Component Dichotomy

- classes were used to represent stateful logic
- functions were used to represent pure logic

---

### React Hooks

- Bring stateful logic and side effects to function components
- it is all about co-location
- Compose and share state and effects

---

### Before Hooks

<Img src='./img/hooksBefore.jpeg' width={350} />

---

### After Hooks

<Img src='./img/hooksAfter.jpeg' width={350} />

---

### Hooks Gif

<Img src='./img/hooksGif.gif' width={350} />

---

# Primitive Hooks

---

### Rules of Hooks

- Only Call Hooks at the Top Level (Don’t call Hooks inside loops, conditions, or nested functions)
- Only Call Hooks from React Functional Components
- Do not work with classes

---

### useState

<Img src='./img/useState.png' width={700} />

---

### useState

- Declares a value that will be managed by this component

---

### old style setState

<Img src='./img/setState.png' width={400} />

---

### useContext

<Img src='./img/useContext.png' width={600} />

---

### useContext

- reads a context value on render from the closest `<Provider>`
- it will be rerendered when context value changes

---

### old style contextType class

<Img src='./img/contextType.png' width={600} />

---

### Component Lifecycle

<Img src='./img/lifecycle.png' width={1000} />

---

### Component Lifecycle (Full)

<Img src='./img/lifecycleFull.png' width={800} />

---

### useEffect

- replaces the use of component lifecycles
- let you hook in commit phase
- happen "after render"
- it is about synchronization

---

### useEffect - examples

- data fetching (use suspense approach instead)
- subscriptions
- manually changing the DOM

---

### Effect without cleanup (lifecycle)

<Img src='./img/lifecycleNoCleanup.png' width={500} />

---

### Effect without cleanup (useEffect)

<Img src='./img/useEffectNoCleanup.png' width={500} />

---

### Effect with cleanup (lifecycle)

<Img src='./img/lifecycleCleanup.png' width={350} />

---

### Effect with cleanup (useEffect)

<Img src='./img/useEffectCleanup.png' width={600} />

---

### Lifecycle Optimization

<Img src='./img/useEffectOptimizationLifecycle.png' width={1000} />

---

### useEffect Optimization

<Img src='./img/useEffectOptimization.png' width={1000} />

---

### Hooks Array of Dependencies

- Some hooks receive an array of dependencies
- it is used to avoid closure pitfalls
- it will memoize hooks based on deps

---

### Eslint Plugin React Hooks

- rules-of-hooks
- exhaustive-deps: make sure all deps are on array of deps

---

### useReducer

- alternative from useState
- better for states that change together
- redux like api

---

### useReducer

<Img src='./img/reducer.png' width={300} />

---

### useReducer

<Img src='./img/useReducer.png' width={300} />

---

### useCallback

- memoize a `callback` (function)
- avoid unnecessary renders

---

### useCallback

<Img src='./img/useCallback.png' width={700} />

---

### useMemo

- memoize a `value`
- only recompute if array of deps changes
- used for optimizations and avoid unnecessary re-renders

---

### useMemo

<Img src='./img/useMemo.png' width={1000} />

---

### useRef

- store `mutable` ref object
- persist for the full lifetime of the component
- "instance" variable
- can store a DOM ref
- doesn’t notify you when its content changes

---

### useRef - mutable value

<Img src='./img/useIsMounted.png' width={500} />

---

### useRef - DOM ref

<Img src='./img/domRef.png' width={700} />

---

### useRef - instance variable

<Img src='./img/useRefInstance.png' width={450} />

---

### Callback Ref

<Img src='./img/callbackRef.png' width={600} />

---

### useImperativeHandle

- used to customize the instance of a value (ref)
- imperative code should be avoided in most cases

---

### useImperativeHandle

<Img src='./img/useImperativeHandle.png' width={550} />

---

### useLayoutEffect

- similar to useEffect
- synchronous
- used to read layout
- does not work in SSR
- can be used to avoid flicker

---

### useLayoutEffect

<Img src='./img/useLayoutEffect.png' width={400} />

---

### useDebugValue

- display a custom label on React Dev Tools

---

### useDebugValue

<Img src='./img/useDebugValue.png' width={650} />

---

# Concurrent Mode Hooks

---

### useTransition

- avoid loading state when transition to the next screen
- only show loading indicator if transition takes too long

---

### useTransition

<Img src='./img/useTransition.png' width={550} />

---

### useDeferredValue

- show a `lag behind` value
- useful to keep interface responsive

---

### useDeferredValue

<Img src='./img/useDeferredValue.png' width={750} />

---

# Custom Hooks

---

### Custom Hooks

- a function that starts with `use`
- a function that may call other hooks

---

# Custom Hooks Examples

---

### usePrevious

<Img src='./img/usePrevious.png' width={700} />

---

### useToday

<Img src='./img/useToday.png' width={700} />

---

### useWhyDidUpdate

<Img src='./img/useWhyDidUpdate.png' width={600} />

---

### usePrompt

<Img src='./img/usePrompt.png' width={300} />

---

# Redux Hooks

---

### useSelector

- extract data from from redux store state
- equivalent/replacement to `mapStateToProps`
- still needs `reselect` to memoize selectors

---

### useSelector

<Img src='./img/useSelector.png' width={900} />

---

### mapStateToProps (old style)

<Img src='./img/mapStateToProps.png' width={750} />

---

## useDispatch

- used to dispatch actions to redux store
- equivalent/replacement to `mapDispatchToProps`

---

## useDispatch

<Img src='./img/useDispatch.png' width={750} />

---

### mapDispatchToProps (old style)

<Img src='./img/mapDispatchToProps.png' width={600} />

---

## useStore

- return the store passed to Provider
- try to avoid this

---

## useStore

<Img src='./img/useStore.png' width={900} />

---

# Hooks Everywhere

---

# Fast Refresh

---

### Fast Refresh

- new implementation of "hot reloading"
- available on react native >=0.61.x
- local state is preserved only for functions components
- unify "live reloading" and "hot reload"

---

### Fast Refresh

- not available on react web yet
- better error handling
- force reset using a comment syntax `@refresh reset`

---

### How it works?

- `React Refresh Babel` plugin to register components and hooks
- `React Refresh Runtime` to update/refresh components that changed

---

### What's Next?

- maybe more primitive hooks in concurrent mode?
- fast refresh on web

---

## References

- [Reactjs Docs](https://reactjs.org/docs/)
- [Redux Docs](https://react-redux.js.org/next/api/hooks)
- [threepointone tweet about hooks](https://twitter.com/threepointone/status/1056594421079261185)
- [gif hooks tweet](https://twitter.com/prchdk/status/1056960391543062528)
- [A Complete Guide to useEffect](https://overreacted.io/a-complete-guide-to-useeffect/)

---

## References

- [My Wishlist For Hot Reloading](https://overreacted.io/my-wishlist-for-hot-reloading/)
- [Why isn't X a Hook](https://overreacted.io/why-isnt-x-a-hook/)
- [Writing Resilient Components](https://overreacted.io/writing-resilient-components/)
- [Eslint Plugin React Hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks)
- [When to useLayoutEffect instead of useEffect](https://daveceddia.com/useeffect-vs-uselayouteffect/)
- [Fast Refresh](https://facebook.github.io/react-native/docs/fast-refresh)

---

<Thanks />

---

<Feedback />
